# SPDX-FileCopyrightText: 2023 Analytics in Motion <https://www.analyticsinmotion.com>
# SPDX-License-Identifier: BSD-3-Clause

"""
Input validation and consistent exceptions for werpy public functions.
"""

import numpy as np


def error_handler(reference, hypothesis):
    """
    Validate inputs and raise consistent exceptions.

    This function does not compute metrics. Computation is handled by:
    - metrics.metrics (router) for strings and batches
    - metrics.calculations for a single pair

    Parameters
    ----------
    reference : str, list or numpy array
        The ground truth transcription of a recorded speech or the expected output of a live speech.
    hypothesis : str, list or numpy array
        The text generated by a speech-to-text algorithm/system which will be compared to the reference text.

    Raises
    ------
    ValueError
        if the two input parameters do not contain the same amount of elements.
    AttributeError
        if input text is not a string, list or np.ndarray data type.
    ZeroDivisionError
        if input in reference is blank or both reference and hypothesis are empty.

    Returns
    -------
    bool
        True if validation passes.
    """
    valid_types = (str, list, np.ndarray)

    if not isinstance(reference, valid_types) or not isinstance(hypothesis, valid_types):
        raise AttributeError(
            "All text should be in a string format. Please check your input does not include any "
            "Numeric data types."
        )

    ref_is_seq = isinstance(reference, (list, np.ndarray))
    hyp_is_seq = isinstance(hypothesis, (list, np.ndarray))

    if ref_is_seq != hyp_is_seq:
        raise AttributeError(
            "Reference and hypothesis must both be strings, or both be lists/arrays."
        )

    if ref_is_seq and hyp_is_seq:
        if len(reference) != len(hypothesis):
            raise ValueError(
                "The Reference and Hypothesis input parameters must have the same number of elements."
            )
        return True

    # At this point, both are strings (validated above)
    ref_s = str(reference).strip()
    hyp_s = str(hypothesis).strip()

    if ref_s == "" and hyp_s == "":
        raise ZeroDivisionError(
            "Invalid input: reference must not be blank, and reference and hypothesis cannot both be empty."
        )
    if ref_s == "":
        raise ZeroDivisionError(
            "Invalid input: reference must not be blank, and reference and hypothesis cannot both be empty."
        )

    return True
